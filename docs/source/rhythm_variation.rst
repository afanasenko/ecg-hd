
Спектральный анализ вариабельности сердечного ритма
###################################################

Алгоритм
--------

1. Из метаданных каждого кардиоцикла извлекаются положение центра и значение
RR-интервала.
2.  Артефакты и экстрасистолы отбрасываются.
3. С помощью интреполяции sin(x)/x рассчитывается сигнал ритма с измененной
частотой дискретизации.
4. Вычитается постоянная составляющая (средний ритм).
5. Рассчитывается быстрое преобразование Фурье.
6. Рассчитывается модуль комплексного спектра (амплитудный спектр).
7. Полученные спектральные составляющие разбиваются на диапазоны с заданными
частотными границами.
8. В каждом диапазоне вычисляется мощность (сумма квадратов спектральных
составляющих амплитудного спектра).
9. Значения мощности во всех диапазонах нормируются, чтобы их сумма была равна
единице.

При разбиении спектра используются седующие частотные диапазоны:

HF — высокочастотный (0,15-0,4 Гц). HF-компонента признана как маркер активности парасимпатической системы.
LF — низкочастотный (0,04-0,15 Гц). Интерпретация LF-компоненты является более противоречивой. Одними исследователями она трактуется как маркер симпатической модуляции, другими — как параметр, включающий симпатическое и вагусное влияние.
VLF — очень низкочастотный (0,003-0,04 Гц). Происхождение VLF и ULF-компонент нуждается в дальнейшем изучении. По предварительным данным, VLF отражает активность симпатического подкоркового центра регуляции.
ULF — ультранизкочастотный (< 0,003 Гц). Для 5-минутной записи ЭКГ-оценка и интерпретация ULF-компоненты некорректна из-за нарушения требуемого соотношения между длительностью регистрации и нижней частотой спектра. Поэтому использование данной компоненты оправдано лишь при 24-часовом исследовании ЭКГ




Интерфейс
---------

асчет частотных составляющих сердечного ритма выполняется функцией
*rhythm_spectrum* из модуля spectralvariation.py.

:
    rhythm_spectrum(metadata, **kwargs):

Входные параметры
^^^^^^^^^^^^^^^^^

Параметр metadata: список метаданных для последовательности кардиоциклов.
Используется только для чтения. Требуется наличие следующих ключей для
каждого кардиоцикла:

- qrs_center
- RR

В kwargs могут быть переданы необязательные параметры:

- freq_bands - список границ частотных диапазонов (Гц)
- sampling - желаемая частота дискретизации сигнала ритма.

По умолчанию эти значения берутся из файла config.yaml, секция RSVAR:

sampling: 1.0
freq_bands:
- 0.0
- 0.003
- 0.04
- 0.15
- 0.4

Значения freq_bands должны начинаться с нуля и идти в порядке возрастания.
Частота дискретизации сигнала ритма (sampling) должа быть как минимум
вдвое превышать максимальную (последнюю) частоту, указанную во freq_bands.

Выходные значения
^^^^^^^^^^^^^^^^^

- retn - относительная мощность спектра в заданных диапазонах
- fp - частоты для построения амплитудного спектра
- sp - значения для построения амплитудного спектра

retn представляет собой список, в каждом элементе которого содержатся данные
 по одной полосе частот.

retn = [
  (f1, f2, pw),
  ...
]

где f1 и f2 - границы частотного диапазона, определяемые
входным параметром freq_bands, pw - относительная мощность спектра в данном
диапазоне. Данные о спектральной мощности нормализованы таким образом, что
сумма всех значений pw равна единице.

Значения fp и sp предназначены для разработки и отладки

Пример вызова
^^^^^^^^^^^^^

Упрощенный вариант, без коррекции входного сигнала

::
    from cardio_clean.spectralvariation import rhythm_spectrum
    from cardio_clean.util import ecgread
    from cardio_clean.wavdetect import find_points
    from cardio_clean.qrsdetect import qrs_detection

    sig, header = ecgread(filename)

    find_points(
        sig[smp_from:smp_to, :],
        fs=header["fs"],
        bias=header["baseline"],
        metadata=metadata
    )

    metadata_postprocessing(
        metadata,
        sig[smp_from:smp_to, :],
        header
    )

    svar = rhythm_spectrum(metadata)[0]



