# Пакет для обработки кардиосигнала

## Порядок обработки:

### Предварительная фильтрация
#### 1. Подавление сетевой помехи
blobapi_mains_correction

#### 2. Коррекция дрейфа изолинии
blobapi_fix_baseline

### Выделение кардиоциклов и расчет их параметров
Вся обработка выполняется функцией  *blobapi_detect_qrs*

Если была выполнена ручная коррекция (например, изменено положение
характерных точек), необходимо обновить зависимые параметры с помощью
функции *blobapi_postprocessing_qrs*

Подробная информация о метаданных, возвращаемых функцией *blobapi_detect_qrs*,
содержится в документе [ecg_metadata.md](ecg_metadata.md)

### Классификация кардиоциклов
Вся обработка выполняется функцией  *blobapi_classify_qrs*

*classdesc = blobapi_classify_qrs(inbuf, metadata, classgen_threshold=0.85)*

Результатом является массив описаний найденных классов.
Описание каждого класса имеет следующую структуру:

     {
            "type": (string) тип комлпекса в классе.
                 Возможные значения "N", "S", "V", "U"
            "id": (int) порядковый номер класса
            "average": (2-d float array) усредненный комплекс
            "count": (int) число комплексов, принадлежащих классу
     }

Помимо расчета описаний классов, функция модифицирует значения metadata,
добавляя значение ключа qrs_class_id (порядковый номер класса в массиве описаний).
Комплексы, ранее отмеченные как артефакты, в классификации не участвуют.
Комплексы, выделившиеся в отдельный класс (т.е. нет похожих комплексов)
помечаются как артефакты, qrs_class_id для них записывается как None.


### Классификация аритмий
Вся обработка выполняется функцией  *blobapi_classify_rythms*
Результатом является массив описаний найденных эпизодов.
Описание каждого эпизода имеет следующую структуру:

     {
            "desc": (string) тип аритмии (кодовая строка)
            "start": (float) начало эпизода в секундах от начала записи
            "end": (float) конец эпизода в секундах от начала записи
            "modified": (bool) флаг ручного редактирования
     }

Возможные значения поля desc см. в файле rhythms.py


### Выявление эпизодов ишемии
Эпизоды ишемии ищутся в каждом из отведении отдельно.
Вся обработка выполняется функцией  *blobapi_find_ishemia*.
Результатом является массив описаний найденных эпизодов.
Описание каждого эпизода имеет следующую структуру:

     {
            "type": (string) тип эпизода ишемии.
                 Возможные значения "K1", "K2", "K3", "E1", "E2"
            "channel": (int) номер отведения
            "start": (float) начало эпизода в секундах от начала записи
            "end": (float) конец эпизода в секундах от начала записи
            "count": (int) число комплексов данного типа
            "max_offset": (float) максимальное смещение ST в эпизоде
            "heartrate": (float) средняя ЧСС в эпизоде
            "modified": (bool) флаг ручного редактирования
     }
